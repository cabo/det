<!DOCTYPE html>
<html lang="en" class="Internet-Draft">
<head>
<meta charset="utf-8">
<meta content="Common,Latin" name="scripts">
<meta content="initial-scale=1.0" name="viewport">
<title>CBOR Common Deterministic Encoding (CDE)</title>
<meta content="Carsten Bormann" name="author">
<meta content='
       CBOR (STD 94, RFC 8949) defines "Deterministically Encoded CBOR" in
its Section 4.2, providing some flexibility for application specific
decisions.
To facilitate Deterministic Encoding to be offered as a selectable
feature of generic encoders, the present document defines a
CBOR Common Deterministic Encoding (CDE) Profile that can be shared by a
large set of applications with potentially diverging detailed
requirements.
It also defines "Basic Serialization", which stops short of the
potentially more onerous requirements that make CDE fully
deterministic, while employing most of its reductions of the
variability needing to be handled by decoders. 
    ' name="description">
<meta content="xml2rfc 3.23.2" name="generator">
<meta content="draft-ietf-cbor-cde-latest" name="ietf.draft">
<!-- Generator version information:
  xml2rfc 3.23.2
    Python 3.12.7
    ConfigArgParse 1.7
    google-i18n-address 3.1.1
    intervaltree 3.1.0
    Jinja2 3.1.4
    lxml 4.9.4
    platformdirs 4.3.6
    pycountry 22.3.5
    PyYAML 6.0.1
    requests 2.32.3
    setuptools 70.3.0
    wcwidth 0.2.13
-->
<link href="draft-ietf-cbor-cde.xml" rel="alternate" type="application/rfc+xml">
<link href="#copyright" rel="license">
<style type="text/css">@font-face {
  font-family: 'Lora';
  font-style: italic;
  font-weight: 400;
  font-display: swap;
  src: local('Lora Italic'), local('Lora-Italic'), url('https://martinthomson.github.io/rfc-css/fonts/lora-italic-cyrillic-ext.woff2') format('woff2');
  unicode-range: U+0460-052F, U+1C80-1C88, U+20B4, U+2DE0-2DFF, U+A640-A69F, U+FE2E-FE2F;
}
@font-face {
  font-family: 'Lora';
  font-style: italic;
  font-weight: 400;
  font-display: swap;
  src: local('Lora Italic'), local('Lora-Italic'), url('https://martinthomson.github.io/rfc-css/fonts/lora-italic-cyrillic-ext.woff2') format('woff2');
  unicode-range: U+0400-045F, U+0490-0491, U+04B0-04B1, U+2116;
}
@font-face {
  font-family: 'Lora';
  font-style: italic;
  font-weight: 400;
  font-display: swap;
  src: local('Lora Italic'), local('Lora-Italic'), url('https://martinthomson.github.io/rfc-css/fonts/lora-italic-vietnamese.woff2') format('woff2');
  unicode-range: U+0102-0103, U+0110-0111, U+1EA0-1EF9, U+20AB;
}
@font-face {
  font-family: 'Lora';
  font-style: italic;
  font-weight: 400;
  font-display: swap;
  src: local('Lora Italic'), local('Lora-Italic'), url('https://martinthomson.github.io/rfc-css/fonts/lora-italic-latin-ext.woff2') format('woff2');
  unicode-range: U+0100-024F, U+0259, U+1E00-1EFF, U+2020, U+20A0-20AB, U+20AD-20CF, U+2113, U+2C60-2C7F, U+A720-A7FF;
}

@font-face {
  font-family: 'Lora';
  font-style: italic;
  font-weight: 400;
  font-display: swap;
  src: local('Lora Italic'), local('Lora-Italic'), url('https://martinthomson.github.io/rfc-css/fonts/lora-italic-latin.woff2') format('woff2');
  unicode-range: U+0000-00FF, U+0131, U+0152-0153, U+02BB-02BC, U+02C6, U+02DA, U+02DC, U+2000-206F, U+2074, U+20AC, U+2122, U+2191, U+2193, U+2212, U+2215, U+FEFF, U+FFFD;
}
@font-face {
  font-family: 'Lora';
  font-style: normal;
  font-weight: 400;
  font-display: swap;
  src: local('Lora Regular'), local('Lora-Regular'), url('https://martinthomson.github.io/rfc-css/fonts/lora-regular-cyrillic-ext.woff2') format('woff2');
  unicode-range: U+0460-052F, U+1C80-1C88, U+20B4, U+2DE0-2DFF, U+A640-A69F, U+FE2E-FE2F;
}
@font-face {
  font-family: 'Lora';
  font-style: normal;
  font-weight: 400;
  font-display: swap;
  src: local('Lora Regular'), local('Lora-Regular'), url('https://martinthomson.github.io/rfc-css/fonts/lora-regular-cyrillic.woff2') format('woff2');
  unicode-range: U+0400-045F, U+0490-0491, U+04B0-04B1, U+2116;
}
@font-face {
  font-family: 'Lora';
  font-style: normal;
  font-weight: 400;
  font-display: swap;
  src: local('Lora Regular'), local('Lora-Regular'), url('https://martinthomson.github.io/rfc-css/fonts/lora-regular-vietnamese.woff2') format('woff2');
  unicode-range: U+0102-0103, U+0110-0111, U+1EA0-1EF9, U+20AB;
}
@font-face {
  font-family: 'Lora';
  font-style: normal;
  font-weight: 400;
  font-display: swap;
  src: local('Lora Regular'), local('Lora-Regular'), url('https://martinthomson.github.io/rfc-css/fonts/lora-regular-latin-ext.woff2') format('woff2');
  unicode-range: U+0100-024F, U+0259, U+1E00-1EFF, U+2020, U+20A0-20AB, U+20AD-20CF, U+2113, U+2C60-2C7F, U+A720-A7FF;
}
@font-face {
  font-family: 'Lora';
  font-style: normal;
  font-weight: 400;
  font-display: swap;
  src: local('Lora Regular'), local('Lora-Regular'), url('https://martinthomson.github.io/rfc-css/fonts/lora-regular-latin.woff2') format('woff2');
  unicode-range: U+0000-00FF, U+0131, U+0152-0153, U+02BB-02BC, U+02C6, U+02DA, U+02DC, U+2000-206F, U+2074, U+20AC, U+2122, U+2191, U+2193, U+2212, U+2215, U+FEFF, U+FFFD;
}

@font-face {
  font-family: 'Lora';
  font-style: normal;
  font-weight: 700;
  font-display: swap;
  src: local('Lora Bold'), local('Lora-Bold'), url('https://martinthomson.github.io/rfc-css/fonts/lora-bold-cyrillic-ext.woff2') format('woff2');
  unicode-range: U+0460-052F, U+1C80-1C88, U+20B4, U+2DE0-2DFF, U+A640-A69F, U+FE2E-FE2F;
}
@font-face {
  font-family: 'Lora';
  font-style: normal;
  font-weight: 700;
  font-display: swap;
  src: local('Lora Bold'), local('Lora-Bold'), url('https://martinthomson.github.io/rfc-css/fonts/lora-bold-cyrillic.woff2') format('woff2');
  unicode-range: U+0400-045F, U+0490-0491, U+04B0-04B1, U+2116;
}
@font-face {
  font-family: 'Lora';
  font-style: normal;
  font-weight: 700;
  font-display: swap;
  src: local('Lora Bold'), local('Lora-Bold'), url('https://martinthomson.github.io/rfc-css/fonts/lora-bold-vietnamese.woff2') format('woff2');
  unicode-range: U+0102-0103, U+0110-0111, U+1EA0-1EF9, U+20AB;
}
@font-face {
  font-family: 'Lora';
  font-style: normal;
  font-weight: 700;
  font-display: swap;
  src: local('Lora Bold'), local('Lora-Bold'), url('https://martinthomson.github.io/rfc-css/fonts/lora-bold-latin-ext.woff2') format('woff2');
  unicode-range: U+0100-024F, U+0259, U+1E00-1EFF, U+2020, U+20A0-20AB, U+20AD-20CF, U+2113, U+2C60-2C7F, U+A720-A7FF;
}
@font-face {
  font-family: 'Lora';
  font-style: normal;
  font-weight: 700;
  font-display: swap;
  src: local('Lora Bold'), local('Lora-Bold'), url('https://martinthomson.github.io/rfc-css/fonts/lora-bold-latin.woff2') format('woff2');
  unicode-range: U+0000-00FF, U+0131, U+0152-0153, U+02BB-02BC, U+02C6, U+02DA, U+02DC, U+2000-206F, U+2074, U+20AC, U+2122, U+2191, U+2193, U+2212, U+2215, U+FEFF, U+FFFD;
}
@font-face {
  font-family: 'Lora';
  font-style: normal;
  font-weight: 600;
  font-display: swap;
  src: local('Lora SemiBold'), local('Lora-SemiBold'), url('https://martinthomson.github.io/rfc-css/fonts/lora-semibold-latin.woff2') format('woff2');
  unicode-range: U+0000-00FF, U+0131, U+0152-0153, U+02BB-02BC, U+02C6, U+02DA, U+02DC, U+2000-206F, U+2074, U+20AC, U+2122, U+2191, U+2193, U+2212, U+2215, U+FEFF, U+FFFD;
}

@font-face {
  font-family: 'Cabin Condensed';
  font-style: normal;
  font-weight: 600;
  font-display: swap;
  src: local('Cabin Condensed SemiBold'), local('CabinCondensed-SemiBold'), url('https://martinthomson.github.io/rfc-css/fonts/cabincondensed-semibold-vietnamese.woff2') format('woff2');
  unicode-range: U+0102-0103, U+0110-0111, U+1EA0-1EF9, U+20AB;
}
@font-face {
  font-family: 'Cabin Condensed';
  font-style: normal;
  font-weight: 600;
  font-display: swap;
  src: local('Cabin Condensed SemiBold'), local('CabinCondensed-SemiBold'), url('https://martinthomson.github.io/rfc-css/fonts/cabincondensed-semibold-latin-ext.woff2') format('woff2');
  unicode-range: U+0100-024F, U+0259, U+1E00-1EFF, U+2020, U+20A0-20AB, U+20AD-20CF, U+2113, U+2C60-2C7F, U+A720-A7FF;
}
@font-face {
  font-family: 'Cabin Condensed';
  font-style: normal;
  font-weight: 600;
  font-display: swap;
  src: local('Cabin Condensed SemiBold'), local('CabinCondensed-SemiBold'), url('https://martinthomson.github.io/rfc-css/fonts/cabincondensed-semibold-latin.woff2') format('woff2');
  unicode-range: U+0000-00FF, U+0131, U+0152-0153, U+02BB-02BC, U+02C6, U+02DA, U+02DC, U+2000-206F, U+2074, U+20AC, U+2122, U+2191, U+2193, U+2212, U+2215, U+FEFF, U+FFFD;
}

@font-face {
  font-family: 'Oxygen Mono';
  font-style: normal;
  font-weight: 400;
  font-display: swap;
  src: local('Oxygen Mono'), local('OxygenMono-Regular'), url('https://martinthomson.github.io/rfc-css/fonts/oxygenmono-regular-latin-ext.woff2') format('woff2');
  unicode-range: U+0100-024F, U+0259, U+1E00-1EFF, U+2020, U+20A0-20AB, U+20AD-20CF, U+2113, U+2C60-2C7F, U+A720-A7FF;
}
@font-face {
  font-family: 'Oxygen Mono';
  font-style: normal;
  font-weight: 400;
  font-display: swap;
  src: local('Oxygen Mono'), local('OxygenMono-Regular'), url('https://martinthomson.github.io/rfc-css/fonts/oxygenmono-regular-latin.woff2') format('woff2');
  unicode-range: U+0000-00FF, U+0131, U+0152-0153, U+02BB-02BC, U+02C6, U+02DA, U+02DC, U+2000-206F, U+2074, U+20AC, U+2122, U+2191, U+2193, U+2212, U+2215, U+FEFF, U+FFFD;
}

:root {
  color-scheme: light dark;
  --background-color: #fff;
  --text-color: #222;
  --title-color: #191919;
  --link-color: #2a6496;
  --highlight-color: #f9f9f9;
  --line-color: #eee;
  --pilcrow-weak: #ddd;
  --pilcrow-strong: #bbb;
  --small-font-size: 14.5px;
  --font-mono: 'Oxygen Mono', monospace;
  scrollbar-color: #bbb #eee;
}
body {
  max-width: 600px;
  margin: 75px auto;
  padding: 0 5px;
  color: var(--text-color);
  background-color: var(--background-color);
  font: 16px/22px "Lora", serif;
  scroll-behavior: smooth;
}

.ears {
  display: none;
}

/* headings */
h1, h2, h3, h4, h5, h6 {
  font-family: "Cabin Condensed", sans-serif;
  font-weight: 600;
  margin: 0.8em 0 0.3em;
  font-size-adjust: 0.5;
  color: var(--title-color);
}
h1#title {
  font-size: 32px;
  line-height: 40px;
  clear: both;
}
h1#title, h1#rfcnum {
  margin: 1.5em 0 0.2em;
}
h1#rfcnum + h1#title {
  margin: 0.2em 0;
}

h1, h2, h3 {
  font-size: 22px;
  line-height: 27px;
}
h4, h5, h6 {
  font-size: 20px;
  line-height: 24px;
}

/* general structure */
.author {
  padding-bottom: 0.3em;
}
#abstract+p {
  font-size: 18px;
  line-height: 24px;
}
#abstract+p code, #abstract+p samp, #abstract+p tt {
  font-size: 16px;
  line-height: 0;
}

p {
  padding: 0;
  margin: 0.5em 0;
  text-align: left;
}
div {
  margin: 0;
}
.alignRight.art-text {
  background-color: var(--highlight-color);
  border: 1px solid var(--line-color);
  border-radius: 3px;
  padding: 0.5em 1em 0;
  margin-bottom: 0.5em;
}
.alignRight.art-text pre {
  padding: 0;
  width: auto;
}
.alignRight {
  margin: 1em 0;
}
.alignRight > *:first-child {
  border: none;
  margin: 0;
  float: right;
  clear: both;
}
.alignRight > *:nth-child(2) {
  clear: both;
  display: block;
  border: none;
}
svg {
  display: block;
}
/* font-family isn't space-separated, but =~ will have to do */
svg[font-family~="monospace" i], svg [font-family~="monospace" i] {
  font-family: var(--font-mono);
}
.alignCenter.art-text {
  background-color: var(--highlight-color);
  border: 1px solid var(--line-color);
  border-radius: 3px;
  padding: 0.5em 1em 0;
  margin-bottom: 0.5em;
}
.alignCenter.art-text pre {
  padding: 0;
  width: auto;
}
.alignCenter {
  margin: 1em 0;
}
.alignCenter > *:first-child {
  border: none;
  /* this isn't optimal, but it's an existence proof.  PrinceXML doesn't
     support flexbox yet.
  */
  display: table;
  margin: 0 auto;
}

/* lists */
ol, ul {
  padding: 0;
  margin: 0 0 0.5em 2em;
}
:is(ol, ul) :is(ol, ul) {
  margin-left: 1em;
}
li {
  margin: 0 0 0.25em 0;
}
.ulCompact li {
  margin: 0;
}
ul.empty, .ulEmpty {
  list-style-type: none;
}
ul.empty li, .ulEmpty li {
  margin-top: 0.5em;
}
:is(ul, ol).compact, .ulCompact, .olCompact {
  line-height: 1;
  margin: 0 0 0 2em;
}

/* definition lists */
dl {
  clear: left;
  --indent: 3ch;
  /* --indent: attr(indent ch); not supported in any browser, but we can dream */
}
dl.olPercent {
  --indent: 5ch;
}
dl > dt {
  float: left;
  margin-right: 2ch;
  min-width: 8ch;
}
dl.dlNewline > dt {
  float: none;
}
dl > dd {
  margin-bottom: .8em;
  margin-left: var(--indent) !important; /* stupid element overrides */
  min-height: 2ex;
}
dl.olPercent > dt {
  min-width: calc(var(--indent) - 2ch);
}
:is(dl.compact, .dlCompact) > dd {
  margin-bottom: 0;
}
:is(dl.compact, .dlCompact) > dd > :is(:first-child, .break:first-child + *) {
  margin-top: 0;
}
:is(dl.compact, .dlCompact) > dd > :is(:last-child) {
  margin-bottom: 0;
}
dl > dd > dl {
  margin-top: 0.5em;
  margin-bottom: 0;
}
:is(dd, span).break {
  display: none;
}

/* links */
a, a[href].selfRef:hover {
  text-decoration: none;
}
a[href] {
  color: var(--link-color);
}
a[href].selfRef, .iref + a[href].internal {
  color: var(--text-color);
}
a[href]:hover {
  text-decoration: underline;
}
a[href].selfRef:hover {
  background-color: var(--highlight-color);
}
a.xref:is(.cite, .auto), :is(#status-of-memo, #copyright) a {
  white-space: nowrap;
}

/* Figures */
tt, code, pre {
  background-color: var(--highlight-color);
  font: 14px/22px var(--font-mono);
}
tt, code {
  /* changing the font for inline elements leads to different ascender
     and descender heights; as we want to retain baseline alignment,
     remove leading to avoid altering the final height of lines
     note: this fails if these blocks take an entire line,
     a different solution would be great */
  line-height: 0;
}
:is(h1, h2, h3, h4, h5, h6) :is(tt, code) {
  font-size: 84%;
}
pre {
  border: 1px solid var(--line-color);
  font-size: 13.5px;
  line-height: 16px;
  letter-spacing: -0.2px;
  margin: 5px;
  padding: 5px;
}
img {
  max-width: 100%;
}
figure {
  margin: 0.5em 0;
  padding: 0;
}
figure blockquote {
  margin: 0.8em 0.4em 0.4em;
}
figcaption, caption {
  font-style: italic;
  margin: 0.5em 1.5em;
  text-align: left;
}
@media screen {
  /* Auto-collapse boilerplate. */
  :is(#status-of-memo, #copyright) p {
    margin: -2px 0;
    max-height: 0;
    transition: max-height 2s ease, margin 0.5s ease 0.5s;
    overflow: hidden;
  }
  :is(#status-of-memo, #copyright):hover p,
  :is(#status-of-memo, #copyright) h2:target ~ p {
    margin: 0.5em 0;
    max-height: 500px;
    overflow: auto;
  }
  pre, svg {
    display: inline-block;
    overflow-x: auto;
  }
  pre {
    max-width: 100%;
    width: calc(100% - 22px - 1em);
  }
  svg {
    max-width: calc(100% - 22px - 1em);
  }
  figure pre {
    display: block;
    width: calc(100% - 25px);
  }
  :is(pre, svg) + .pilcrow {
    display: inline-block;
    vertical-align: text-bottom;
    padding-bottom: 8px;
  }
}

/* aside, blockquote */
aside, blockquote {
  margin-left: 0;
  padding: 0 2em;
  font-style: italic;
}
blockquote {
  margin: 1em 0;
}
cite {
  display: block;
  text-align: right;
  font-style: italic;
}

/* tables */
table {
  max-width: 100%;
  margin: 0 0 1em;
  border-collapse: collapse;
}
table.right {
  margin-left: auto;
}
table.center {
  margin-left: auto;
  margin-right: auto;
}
table.left {
  margin-right: auto;
}
thead, tbody {
  border: 1px solid var(--line-color);
}
th, td {
  text-align: left;
  vertical-align: top;
  padding: 5px 10px;
}
th {
  background-color: var(--line-color);
}
:is(tr:nth-child(2n), thead+tbody > tr:nth-child(2n+1)) > td {
  background-color: var(--background-color);
}
:is(tr:nth-child(2n+1), thead+tbody > tr:nth-child(2n)) > td {
  background-color: var(--highlight-color);
}
table caption {
  margin: 0;
  padding: 3px 0 3px 1em;
}
table p {
  margin: 0;
}

/* pilcrow */
a.pilcrow {
  margin-left: 3px;
  opacity: 0.2;
  user-select: none;
}
a.pilcrow[href] { color: var(--pilcrow-weak); }
a.pilcrow[href]:hover { text-decoration: none; }
@media not print {
  :hover > a.pilcrow {
    opacity: 1;
  }
  a.pilcrow[href]:hover {
    color: var(--pilcrow-strong);
    background-color: transparent;
  }
}
@media print {
  a.pilcrow {
    display: none;
  }
}

/* misc */
hr {
  border: 0;
  border-top: 1px solid var(--line-color);
}
.bcp14 {
  font-variant: small-caps;
  font-weight: 600;
  font-size: var(--small-font-size);
}
.role {
  font-variant: all-small-caps;
}
sub, sup {
  line-height: 1;
  font-size: 80%;
}

/* info block */
#identifiers {
  margin: 0;
  font-size: var(--small-font-size);
  line-height: 18px;
  --identifier-width: 15ch;
}
#identifiers dt {
  width: var(--identifier-width);
  min-width: var(--identifier-width);
  clear: left;
  float: left;
  text-align: right;
  margin-right: 1ch;
}
#identifiers dd {
  margin: 0;
  margin-left: calc(1em + var(--identifier-width)) !important;
  min-width: 5em;
}
#identifiers .authors .author {
  display: inline-block;
  margin-right: 1.5em;
}
#identifiers .authors .org {
  font-style: italic;
}

/* The prepared/rendered info at the very bottom of the page */
.docInfo {
  color: #999;
  font-size: 0.9em;
  font-style: italic;
  margin-top: 2em;
}
.docInfo .prepared {
  float: left;
}
.docInfo .prepared {
  float: right;
}

/* table of contents */
#toc {
  padding: 0.75em 0 2em 0;
  margin-bottom: 1em;
}
#toc nav ul {
  margin: 0 0.5em 0 0;
  padding: 0;
  list-style: none;
}
#toc nav li {
  line-height: 1.3em;
  margin: 2px 0;
  padding-left: 1.2em;
  text-indent: -1.2em;
}
#toc a.xref {
  white-space: normal;
}
/* references */
.references dt {
  text-align: right;
  font-weight: bold;
  min-width: 10ch;
  margin-right: 1.5ch;
}
.references dt:target::before {
  content: "⇒";
  width: 15px;
  margin: 0 10px 0 -25px;
}
.references dd {
  margin-left: 12ch !important;
  overflow: auto;
}

.refInstance {
  margin-bottom: 1.25em;
}

.references .ascii {
  margin-bottom: 0.25em;
}

/* index */
#rfc\.index\.index + ul {
  margin-left: 0;
}

/* authors */
address.vcard {
  font-style: normal;
  margin: 1em 0;
}
address.vcard .nameRole {
  font-weight: 700;
  margin-left: 0;
}
address.vcard .label {
  margin: 0.5em 0;
}
address.vcard .type {
  display: none;
}
.alternative-contact {
  margin: 1.5em 0 1em;
}
hr.addr {
  border-top: 1px dashed;
  margin: 0;
  color: #ddd;
  max-width: calc(100% - 16px);
}
@media (min-width: 500px) {
  #authors-addresses > section {
    column-count: 2;
    column-gap: 20px;
  }
  #authors-addresses > section > h2 {
    column-span: all;
  }
  /* hack for break-inside: avoid-column */
  #authors-addresses address {
    display: inline-block;
    break-inside: avoid-column;
  }
}

.rfcEditorRemove p:first-of-type {
  font-style: italic;
}
.cref {
  background-color: rgba(249, 232, 105, 0.3);
  padding: 2px 4px;
}
.crefSource {
  font-style: italic;
}
/* alternative layout for smaller screens */
@media screen and (max-width: 929px) {
  #toc {
    position: fixed;
    z-index: 2;
    top: 0;
    right: 0;
    padding: 1px 0 0 0;
    margin: 0;
    border-bottom: 1px solid #ccc;
    opacity: 0.6;
  }
  #toc.active {
      opacity: 1;
  }
  #toc h2 {
    margin: 0;
    padding: 2px 0 2px 6px;
    padding-right: 1em;
    font-size: 18px;
    line-height: 24px;
    min-width: 190px;
    text-align: right;
    background-color: #444;
    color: white;
    cursor: pointer;
  }
  #toc h2::before { /* css hamburger */
    float: right;
    position: relative;
    width: 1em;
    height: 1px;
    left: -164px;
    margin: 8px 0 0 0;
    background: white none repeat scroll 0 0;
    box-shadow: 0 4px 0 0 white, 0 8px 0 0 white;
    content: "";
  }
  #toc nav {
    display: none;
    background-color: var(--background-color);
    padding: 0.5em 1em 1em;
    overflow: auto;
    overscroll-behavior: contain;
    height: calc(100vh - 48px);
    border-left: 1px solid #ddd;
  }
  #toc.active nav {
    display: block;
  }
  /* Make the collapsed ToC header render white on gray also when it's a link */
  #toc h2 a,
  #toc h2 a:link,
  #toc h2 a:focus,
  #toc h2 a:hover,
  #toc a.toplink,
  #toc a.toplink:hover {
    color: white;
    background-color: #444;
    text-decoration: none;
  }
  #toc a.toplink {
    margin-top: 2px;
  }
}

/* alternative layout for wide screens */
@media screen and (min-width: 930px) {
  body {
    padding-right: 360px;
    padding-right: calc(min(180px + 20%, 500px));
  }
  #toc {
    position: fixed;
    bottom: 0;
    right: 0;
    right: calc(50vw - 480px);
    width: 312px;
    margin: 0;
    padding: 0;
    z-index: 1;
  }
  #toc h2 {
    margin: 0;
    padding: 0.25em 1em 1em 0;
  }
  #toc nav {
    display: block;
    height: calc(90vh - 84px);
    bottom: 0;
    padding: 0.5em 0 2em;
    overflow: auto;
    overscroll-behavior: contain;
    scrollbar-width: thin;
  }
  #toc nav > ul  {
    margin-bottom: 2em;
  }
  #toc ul {
    margin: 0 0 0 4px;
    font-size: var(--small-font-size);
  }
  #toc ul :is(p, li) {
    margin: 2px 0;
    line-height: 22px;
  }
  img { /* future proofing */
    max-width: 100%;
    height: auto;
  }
}

/* pagination */
@media print {
  body {
    width: 100%;
  }
  p {
    orphans: 3;
    widows: 3;
  }
  #n-copyright-notice {
    border-bottom: none;
  }
  #toc, #n-introduction {
    page-break-before: always;
  }
  #toc {
    border-top: none;
    padding-top: 0;
  }
  figure, pre, .vcard {
    page-break-inside: avoid;
  }
  h1, h2, h3, h4, h5, h6 {
    page-break-after: avoid;
  }
  :is(h2, h3, h4, h5, h6)+*, dd {
    page-break-before: avoid;
  }
  pre {
    white-space: pre-wrap;
    word-wrap: break-word;
    font-size: 10pt;
  }
  table {
    border: 1px solid #ddd;
  }
  td {
    border-top: 1px solid #ddd;
  }
  .toplink {
    display: none;
  }
}

@page :first {
  padding-top: 0;
  @top-left {
    content: normal;
    border: none;
  }
  @top-center {
    content: normal;
    border: none;
  }
  @top-right {
    content: normal;
    border: none;
  }
}

@page {
  size: A4;
  margin-bottom: 45mm;
  padding-top: 20px;
}

/* Changes introduced to fix issues found during implementation */

/* Separate body from document info even without intervening H1 */
section {
  clear: both;
}

/* Top align author divs, to avoid names without organization dropping level with org names */
.author {
  vertical-align: top;
}

/* Style section numbers with more space between number and title */
.section-number {
  padding-right: 0.5em;
}

/* Add styling for a link in the ToC that points to the top of the document */
a.toplink {
  float: right;
  margin: 8px 0.5em 0;
}

/* Provide styling for table cell text alignment */
table .text-left {
  text-align: left;
}
table .text-center {
  text-align: center;
}
table .text-right {
  text-align: right;
}

/* Make the alternative author contact information look less like just another
   author, and group it closer with the primary author contact information */
.alternative-contact {
  margin: 0.5em 0 0.25em 0;
}
address .non-ascii {
  margin: 0 0 0 2em;
}

/* With it being possible to set tables with alignment
  left, center, and right, { width: 100%; } does not make sense */
table {
  width: auto;
}

/* Avoid reference text that sits in a block with very wide left margin,
   because of a long floating dt label.*/
.references dd {
  overflow: visible;
}

/* Control caption placement */
caption {
  caption-side: bottom;
}

/* Limit the width of the author address vcard, so names in right-to-left
   script don't end up on the other side of the page. */

address.vcard {
  max-width: 20em;
  margin-right: auto;
}

/* For address alignment dependent on LTR or RTL scripts */
address div.left {
  text-align: left;
}
address div.right {
  text-align: right;
}

/* Dark mode. */
@media (prefers-color-scheme: dark) {
:root {
  --background-color: #121212;
  --text-color: #f0f0f0;
  --title-color: #fff;
  --link-color: #4da4f0;
  --highlight-color: #282828;
  --line-color: #444;
  --pilcrow-weak: #444;
  --pilcrow-strong: #666;
  scrollbar-color: #777 #333;
}
}

/* SVG Trick: a prefix match works because only black and white are allowed */
svg :is([stroke="black"], [stroke^="#000"]) {
  stroke: var(--text-color);
}
svg :is([stroke="white"], [stroke^="#fff"]) {
  stroke: var(--background-color);
}
svg :is([fill="black"], [fill^="#000"], :not([fill])) {
  fill: var(--text-color);
}
svg :is([fill="white"], [fill^="#fff"]) {
  fill: var(--background-color);
}
</style>

</head>
<body class="xml2rfc">
<table class="ears">
<thead><tr>
<td class="left">Internet-Draft</td>
<td class="center">CBOR CDE</td>
<td class="right">October 2024</td>
</tr></thead>
<tfoot><tr>
<td class="left">Bormann</td>
<td class="center">Expires 19 April 2025</td>
<td class="right">[Page]</td>
</tr></tfoot>
</table>
<div id="external-metadata" class="document-information"></div>
<div id="internal-metadata" class="document-information">
<dl id="identifiers">
<dt class="label-workgroup">Workgroup:</dt>
<dd class="workgroup">CBOR</dd>
<dt class="label-internet-draft">Internet-Draft:</dt>
<dd class="internet-draft">draft-ietf-cbor-cde-latest</dd>
<dt class="label-published">Published:</dt>
<dd class="published">
<time datetime="2024-10-16" class="published">16 October 2024</time>
    </dd>
<dt class="label-intended-status">Intended Status:</dt>
<dd class="intended-status">Best Current Practice</dd>
<dt class="label-expires">Expires:</dt>
<dd class="expires"><time datetime="2025-04-19">19 April 2025</time></dd>
<dt class="label-authors">Author:</dt>
<dd class="authors">
<div class="author">
      <div class="author-name">C. Bormann</div>
<div class="org">Universität Bremen TZI</div>
</div>
</dd>
</dl>
</div>
<h1 id="title">CBOR Common Deterministic Encoding (CDE)</h1>
<section id="section-abstract">
      <h2 id="abstract"><a href="#abstract" class="selfRef">Abstract</a></h2>
<p id="section-abstract-1">CBOR (STD 94, RFC 8949) defines "Deterministically Encoded CBOR" in
its Section 4.2, providing some flexibility for application specific
decisions.
To facilitate Deterministic Encoding to be offered as a selectable
feature of generic encoders, the present document defines a
CBOR Common Deterministic Encoding (CDE) Profile that can be shared by a
large set of applications with potentially diverging detailed
requirements.
It also defines "Basic Serialization", which stops short of the
potentially more onerous requirements that make CDE fully
deterministic, while employing most of its reductions of the
variability needing to be handled by decoders.<a href="#section-abstract-1" class="pilcrow">¶</a></p>
</section>
<section class="note rfcEditorRemove" id="section-note.1">
      <h2 id="name-about-this-document">
<a href="#name-about-this-document" class="section-name selfRef">About This Document</a>
      </h2>
<p id="section-note.1-1">This note is to be removed before publishing as an RFC.<a href="#section-note.1-1" class="pilcrow">¶</a></p>
<p id="section-note.1-2">
        Status information for this document may be found at <span><a href="https://datatracker.ietf.org/doc/draft-ietf-cbor-cde/">https://datatracker.ietf.org/doc/draft-ietf-cbor-cde/</a></span>.<a href="#section-note.1-2" class="pilcrow">¶</a></p>
<p id="section-note.1-3">
        Discussion of this document takes place on the
        Concise Binary Object Representation Maintenance and Extensions (CBOR) Working Group mailing list (<span><a href="mailto:cbor@ietf.org">mailto:cbor@ietf.org</a></span>),
        which is archived at <span><a href="https://mailarchive.ietf.org/arch/browse/cbor/">https://mailarchive.ietf.org/arch/browse/cbor/</a></span>.
        Subscribe at <span><a href="https://www.ietf.org/mailman/listinfo/cbor/">https://www.ietf.org/mailman/listinfo/cbor/</a></span>.<a href="#section-note.1-3" class="pilcrow">¶</a></p>
<p id="section-note.1-4">Source for this draft and an issue tracker can be found at
        <span><a href="https://github.com/cbor-wg/draft-ietf-cbor-cde">https://github.com/cbor-wg/draft-ietf-cbor-cde</a></span>.<a href="#section-note.1-4" class="pilcrow">¶</a></p>
</section>
<div id="status-of-memo">
<section id="section-boilerplate.1">
        <h2 id="name-status-of-this-memo">
<a href="#name-status-of-this-memo" class="section-name selfRef">Status of This Memo</a>
        </h2>
<p id="section-boilerplate.1-1">
        This Internet-Draft is submitted in full conformance with the
        provisions of BCP 78 and BCP 79.<a href="#section-boilerplate.1-1" class="pilcrow">¶</a></p>
<p id="section-boilerplate.1-2">
        Internet-Drafts are working documents of the Internet Engineering Task
        Force (IETF). Note that other groups may also distribute working
        documents as Internet-Drafts. The list of current Internet-Drafts is
        at <span><a href="https://datatracker.ietf.org/drafts/current/">https://datatracker.ietf.org/drafts/current/</a></span>.<a href="#section-boilerplate.1-2" class="pilcrow">¶</a></p>
<p id="section-boilerplate.1-3">
        Internet-Drafts are draft documents valid for a maximum of six months
        and may be updated, replaced, or obsoleted by other documents at any
        time. It is inappropriate to use Internet-Drafts as reference
        material or to cite them other than as "work in progress."<a href="#section-boilerplate.1-3" class="pilcrow">¶</a></p>
<p id="section-boilerplate.1-4">
        This Internet-Draft will expire on 19 April 2025.<a href="#section-boilerplate.1-4" class="pilcrow">¶</a></p>
</section>
</div>
<div id="copyright">
<section id="section-boilerplate.2">
        <h2 id="name-copyright-notice">
<a href="#name-copyright-notice" class="section-name selfRef">Copyright Notice</a>
        </h2>
<p id="section-boilerplate.2-1">
            Copyright (c) 2024 IETF Trust and the persons identified as the
            document authors. All rights reserved.<a href="#section-boilerplate.2-1" class="pilcrow">¶</a></p>
<p id="section-boilerplate.2-2">
            This document is subject to BCP 78 and the IETF Trust's Legal
            Provisions Relating to IETF Documents
            (<span><a href="https://trustee.ietf.org/license-info">https://trustee.ietf.org/license-info</a></span>) in effect on the date of
            publication of this document. Please review these documents
            carefully, as they describe your rights and restrictions with
            respect to this document. Code Components extracted from this
            document must include Revised BSD License text as described in
            Section 4.e of the Trust Legal Provisions and are provided without
            warranty as described in the Revised BSD License.<a href="#section-boilerplate.2-2" class="pilcrow">¶</a></p>
</section>
</div>
<div id="toc">
<section id="section-toc.1">
        <a href="#" onclick="scroll(0,0)" class="toplink">▲</a><h2 id="name-table-of-contents">
<a href="#name-table-of-contents" class="section-name selfRef">Table of Contents</a>
        </h2>
<nav class="toc"><ul class="compact toc ulBare ulEmpty">
<li class="compact toc ulBare ulEmpty" id="section-toc.1-1.1">
            <p id="section-toc.1-1.1.1" class="keepWithNext"><a href="#section-1" class="auto internal xref">1</a>.  <a href="#name-introduction" class="internal xref">Introduction</a></p>
<ul class="compact toc ulBare ulEmpty">
<li class="compact toc ulBare ulEmpty" id="section-toc.1-1.1.2.1">
                <p id="section-toc.1-1.1.2.1.1" class="keepWithNext"><a href="#section-1.1" class="auto internal xref">1.1</a>.  <a href="#name-structure-of-this-document" class="internal xref">Structure of This Document</a></p>
</li>
              <li class="compact toc ulBare ulEmpty" id="section-toc.1-1.1.2.2">
                <p id="section-toc.1-1.1.2.2.1" class="keepWithNext"><a href="#section-1.2" class="auto internal xref">1.2</a>.  <a href="#name-conventions-and-definitions" class="internal xref">Conventions and Definitions</a></p>
</li>
            </ul>
</li>
          <li class="compact toc ulBare ulEmpty" id="section-toc.1-1.2">
            <p id="section-toc.1-1.2.1"><a href="#section-2" class="auto internal xref">2</a>.  <a href="#name-cbor-common-deterministic-e" class="internal xref">CBOR Common Deterministic Encoding Profile (CDE)</a></p>
</li>
          <li class="compact toc ulBare ulEmpty" id="section-toc.1-1.3">
            <p id="section-toc.1-1.3.1"><a href="#section-3" class="auto internal xref">3</a>.  <a href="#name-cddl-support" class="internal xref">CDDL support</a></p>
</li>
          <li class="compact toc ulBare ulEmpty" id="section-toc.1-1.4">
            <p id="section-toc.1-1.4.1"><a href="#section-4" class="auto internal xref">4</a>.  <a href="#name-security-considerations" class="internal xref">Security Considerations</a></p>
</li>
          <li class="compact toc ulBare ulEmpty" id="section-toc.1-1.5">
            <p id="section-toc.1-1.5.1"><a href="#section-5" class="auto internal xref">5</a>.  <a href="#name-iana-considerations" class="internal xref">IANA Considerations</a></p>
</li>
          <li class="compact toc ulBare ulEmpty" id="section-toc.1-1.6">
            <p id="section-toc.1-1.6.1"><a href="#section-6" class="auto internal xref">6</a>.  <a href="#name-references" class="internal xref">References</a></p>
<ul class="compact toc ulBare ulEmpty">
<li class="compact toc ulBare ulEmpty" id="section-toc.1-1.6.2.1">
                <p id="section-toc.1-1.6.2.1.1"><a href="#section-6.1" class="auto internal xref">6.1</a>.  <a href="#name-normative-references" class="internal xref">Normative References</a></p>
</li>
              <li class="compact toc ulBare ulEmpty" id="section-toc.1-1.6.2.2">
                <p id="section-toc.1-1.6.2.2.1"><a href="#section-6.2" class="auto internal xref">6.2</a>.  <a href="#name-informative-references" class="internal xref">Informative References</a></p>
</li>
            </ul>
</li>
          <li class="compact toc ulBare ulEmpty" id="section-toc.1-1.7">
            <p id="section-toc.1-1.7.1"><a href="#appendix-A" class="auto internal xref">Appendix A</a>.  <a href="#name-application-profiles" class="internal xref">Application Profiles</a></p>
</li>
          <li class="compact toc ulBare ulEmpty" id="section-toc.1-1.8">
            <p id="section-toc.1-1.8.1"><a href="#appendix-B" class="auto internal xref">Appendix B</a>.  <a href="#name-implementers-checklists" class="internal xref">Implementers' Checklists</a></p>
<ul class="compact toc ulBare ulEmpty">
<li class="compact toc ulBare ulEmpty" id="section-toc.1-1.8.2.1">
                <p id="section-toc.1-1.8.2.1.1"><a href="#appendix-B.1" class="auto internal xref">B.1</a>.  <a href="#name-preferred-serialization" class="internal xref">Preferred Serialization</a></p>
<ul class="compact toc ulBare ulEmpty">
<li class="compact toc ulBare ulEmpty" id="section-toc.1-1.8.2.1.2.1">
                    <p id="section-toc.1-1.8.2.1.2.1.1"><a href="#appendix-B.1.1" class="auto internal xref">B.1.1</a>.  <a href="#name-preferred-serialization-enc" class="internal xref">Preferred Serialization Encoders</a></p>
</li>
                  <li class="compact toc ulBare ulEmpty" id="section-toc.1-1.8.2.1.2.2">
                    <p id="section-toc.1-1.8.2.1.2.2.1"><a href="#appendix-B.1.2" class="auto internal xref">B.1.2</a>.  <a href="#name-preferred-serialization-dec" class="internal xref">Preferred Serialization Decoders</a></p>
</li>
                </ul>
</li>
              <li class="compact toc ulBare ulEmpty" id="section-toc.1-1.8.2.2">
                <p id="section-toc.1-1.8.2.2.1"><a href="#appendix-B.2" class="auto internal xref">B.2</a>.  <a href="#name-basic-serialization" class="internal xref">Basic Serialization</a></p>
<ul class="compact toc ulBare ulEmpty">
<li class="compact toc ulBare ulEmpty" id="section-toc.1-1.8.2.2.2.1">
                    <p id="section-toc.1-1.8.2.2.2.1.1"><a href="#appendix-B.2.1" class="auto internal xref">B.2.1</a>.  <a href="#name-basic-serialization-encoder" class="internal xref">Basic Serialization Encoders</a></p>
</li>
                  <li class="compact toc ulBare ulEmpty" id="section-toc.1-1.8.2.2.2.2">
                    <p id="section-toc.1-1.8.2.2.2.2.1"><a href="#appendix-B.2.2" class="auto internal xref">B.2.2</a>.  <a href="#name-basic-serialization-decoder" class="internal xref">Basic Serialization Decoders</a></p>
</li>
                </ul>
</li>
              <li class="compact toc ulBare ulEmpty" id="section-toc.1-1.8.2.3">
                <p id="section-toc.1-1.8.2.3.1"><a href="#appendix-B.3" class="auto internal xref">B.3</a>.  <a href="#name-cde" class="internal xref">CDE</a></p>
<ul class="compact toc ulBare ulEmpty">
<li class="compact toc ulBare ulEmpty" id="section-toc.1-1.8.2.3.2.1">
                    <p id="section-toc.1-1.8.2.3.2.1.1"><a href="#appendix-B.3.1" class="auto internal xref">B.3.1</a>.  <a href="#name-cde-encoders" class="internal xref">CDE Encoders</a></p>
</li>
                  <li class="compact toc ulBare ulEmpty" id="section-toc.1-1.8.2.3.2.2">
                    <p id="section-toc.1-1.8.2.3.2.2.1"><a href="#appendix-B.3.2" class="auto internal xref">B.3.2</a>.  <a href="#name-cde-decoders" class="internal xref">CDE Decoders</a></p>
</li>
                </ul>
</li>
            </ul>
</li>
          <li class="compact toc ulBare ulEmpty" id="section-toc.1-1.9">
            <p id="section-toc.1-1.9.1"><a href="#appendix-C" class="auto internal xref"></a><a href="#name-acknowledgments" class="internal xref">Acknowledgments</a></p>
</li>
          <li class="compact toc ulBare ulEmpty" id="section-toc.1-1.10">
            <p id="section-toc.1-1.10.1"><a href="#appendix-D" class="auto internal xref"></a><a href="#name-contributors" class="internal xref">Contributors</a></p>
</li>
          <li class="compact toc ulBare ulEmpty" id="section-toc.1-1.11">
            <p id="section-toc.1-1.11.1"><a href="#appendix-E" class="auto internal xref"></a><a href="#name-authors-address" class="internal xref">Author's Address</a></p>
</li>
        </ul>
</nav>
</section>
</div>
<div id="introduction">
<section id="section-1">
      <h2 id="name-introduction">
<a href="#section-1" class="section-number selfRef">1. </a><a href="#name-introduction" class="section-name selfRef">Introduction</a>
      </h2>
<p id="section-1-1">CBOR (STD 94, RFC 8949) defines "Deterministically Encoded CBOR" in
its Section 4.2, providing some flexibility for application specific
decisions.
To facilitate Deterministic Encoding to be offered as a selectable
feature of generic encoders, the present document defines a
CBOR Common Deterministic Encoding (CDE) Profile that can be shared by a
large set of applications with potentially diverging detailed
requirements.
It also defines "Basic Serialization", which stops short of the
potentially more onerous requirements that make CDE fully
deterministic, while employing most of its reductions of the
variability needing to be handled by decoders.<a href="#section-1-1" class="pilcrow">¶</a></p>
<div id="structure-of-this-document">
<section id="section-1.1">
        <h3 id="name-structure-of-this-document">
<a href="#section-1.1" class="section-number selfRef">1.1. </a><a href="#name-structure-of-this-document" class="section-name selfRef">Structure of This Document</a>
        </h3>
<p id="section-1.1-1">After introductory material, <a href="#dep" class="auto internal xref">Section 2</a> defines the CBOR Common
Deterministic Encoding Profile (CDE).
<a href="#cddl-support" class="auto internal xref">Section 3</a> defines Concise Data Definition Language (CDDL) support for indicating the use of CDE.
This is followed by the conventional sections for
<a href="#seccons" class="internal xref">Security Considerations</a> (<a href="#seccons" class="auto internal xref">4</a>),
<a href="#sec-iana" class="internal xref">IANA Considerations</a> (<a href="#sec-iana" class="auto internal xref">5</a>),
and <a href="#sec-combined-references" class="internal xref">References</a> (<a href="#sec-combined-references" class="auto internal xref">6</a>).<a href="#section-1.1-1" class="pilcrow">¶</a></p>
<p id="section-1.1-2">The informative <a href="#application-profiles" class="auto internal xref">Appendix A</a> introduces the concept of Application Profiles,
which are layered on top of the CBOR CDE Profile and can address
recurring requirements on deterministic representation
of application data where these requirements are specific to a set of
applications.
(Application Profiles themselves, if needed, are defined in separate
documents.)<a href="#section-1.1-2" class="pilcrow">¶</a></p>
<p id="section-1.1-3">The informative <a href="#impcheck" class="auto internal xref">Appendix B</a> provides brief checklists that implementers
can use to check their CDE implementations.
<a href="#ps" class="auto internal xref">Appendix B.1</a> provides a checklist for implementing Preferred Serialization.
<a href="#bs" class="auto internal xref">Appendix B.2</a> introduces "Basic Serialization", a slightly more restricted form
of Preferred Serialization that may be used by encoders to hit a sweet
spot for maximizing interoperability with partial (e.g., constrained)
CBOR decoder implementations.
<a href="#cde" class="auto internal xref">Appendix B.3</a> further restricts Basic Serialization to arrive at CDE.<a href="#section-1.1-3" class="pilcrow">¶</a></p>
</section>
</div>
<div id="conventions-and-definitions">
<section id="section-1.2">
        <h3 id="name-conventions-and-definitions">
<a href="#section-1.2" class="section-number selfRef">1.2. </a><a href="#name-conventions-and-definitions" class="section-name selfRef">Conventions and Definitions</a>
        </h3>
<p id="section-1.2-1">The key words "<span class="bcp14">MUST</span>", "<span class="bcp14">MUST NOT</span>", "<span class="bcp14">REQUIRED</span>", "<span class="bcp14">SHALL</span>", "<span class="bcp14">SHALL NOT</span>", "<span class="bcp14">SHOULD</span>", "<span class="bcp14">SHOULD NOT</span>", "<span class="bcp14">RECOMMENDED</span>", "<span class="bcp14">NOT RECOMMENDED</span>",
"<span class="bcp14">MAY</span>", and "<span class="bcp14">OPTIONAL</span>" in this document are to be interpreted as
described in <span>[<a href="#BCP14" class="cite xref">BCP14</a>]</span> (<a href="#RFC2119" class="auto internal xref">RFC2119</a>) (<a href="#RFC8174" class="auto internal xref">RFC8174</a>) when, and only when, they
appear in all capitals, as shown here.<a href="#section-1.2-1" class="pilcrow">¶</a></p>
</section>
</div>
</section>
</div>
<div id="dep">
<section id="section-2">
      <h2 id="name-cbor-common-deterministic-e">
<a href="#section-2" class="section-number selfRef">2. </a><a href="#name-cbor-common-deterministic-e" class="section-name selfRef">CBOR Common Deterministic Encoding Profile (CDE)</a>
      </h2>
<p id="section-2-1">This specification defines the <em>CBOR Common Deterministic Encoding
Profile</em> (CDE) based on the <em>Core Deterministic Encoding
Requirements</em> defined for CBOR in
Section <a href="https://rfc-editor.org/rfc/rfc8949#section-4.2.1" class="relref">4.2.1</a> of RFC 8949 <span>[<a href="#STD94" class="cite xref">STD94</a>]</span>.<a href="#section-2-1" class="pilcrow">¶</a></p>
<p id="section-2-2">In many cases, CBOR provides more than one way to encode a data item,
but also provides a recommendation for a <em>Preferred Serialization</em>.
The <em>CoRE Deterministic Encoding Requirements</em> generally pick the
preferred serializations as mandatory; they also pick additional choices
such as definite-length encoding.
Finally, they define a map ordering based on lexicographic ordering of
the (deterministically) encoded map keys.<a href="#section-2-2" class="pilcrow">¶</a></p>
<p id="section-2-3">Note that this specific set of requirements is elective — in
principle, other variants of deterministic encoding can be defined
(and have been, now being phased out slowly, as detailed in Section <a href="https://rfc-editor.org/rfc/rfc8949#section-4.2.3" class="relref">4.2.3</a> of RFC 8949 <span>[<a href="#STD94" class="cite xref">STD94</a>]</span>).
In many applications of CBOR today, deterministic encoding is not used
at all, as its restriction of choices can create some additional
performance cost and code complexity.<a href="#section-2-3" class="pilcrow">¶</a></p>
<p id="section-2-4"><span>[<a href="#STD94" class="cite xref">STD94</a>]</span>'s core requirements are designed to provide well-understood and
easy-to-implement rules while maximizing coverage, i.e., the subset of
CBOR data items that are fully specified by these rules, and also
placing minimal burden on implementations.<a href="#section-2-4" class="pilcrow">¶</a></p>
<p id="section-2-5">Section <a href="https://rfc-editor.org/rfc/rfc8949#section-4.2.2" class="relref">4.2.2</a> of RFC 8949 <span>[<a href="#STD94" class="cite xref">STD94</a>]</span> picks up on the interaction of extensibility
(CBOR tags) and deterministic encoding.
CBOR itself uses some tags to increase the range of its basic
generic data types, e.g., tags 2/3 extend the range of basic major
types 0/1 in a seamless way.
Section <a href="https://rfc-editor.org/rfc/rfc8949#section-4.2.2" class="relref">4.2.2</a> of RFC 8949 <span>[<a href="#STD94" class="cite xref">STD94</a>]</span> recommends handling this transition the same
way as with the transition between different integer representation
lengths in the basic generic data model, i.e., by mandating the
preferred serialization for all integers (Section <a href="https://rfc-editor.org/rfc/rfc8949#section-3.4.3" class="relref">3.4.3</a> of RFC 8949 <span>[<a href="#STD94" class="cite xref">STD94</a>]</span>).<a href="#section-2-5" class="pilcrow">¶</a></p>
<ol start="1" type="1" class="normal type-1" id="section-2-6">
<li id="section-2-6.1">
          <p id="section-2-6.1.1">The CBOR Common Deterministic Encoding Profile (CDE) turns this
recommendation into a mandate: Integers that can be represented by
basic major type 0 and 1 are encoded using the deterministic
encoding defined for them, and integers outside this range are
encoded using the preferred serialization (Section <a href="https://rfc-editor.org/rfc/rfc8949#section-3.4.3" class="relref">3.4.3</a> of RFC 8949 <span>[<a href="#STD94" class="cite xref">STD94</a>]</span>) of tag 2 and 3 (i.e., no leading zero bytes).<a href="#section-2-6.1.1" class="pilcrow">¶</a></p>
</li>
      </ol>
<p id="section-2-7">Most tags capture more specific application semantics and therefore
may be harder to define a deterministic encoding for.
While the deterministic encoding of their tag internals is often
covered by the <em>Core Deterministic Encoding Requirements</em>, the mapping
of diverging platform application data types onto the tag contents may
require additional attention to perform it in a deterministic way; see
<span><a href="https://datatracker.ietf.org/doc/html/draft-bormann-cbor-det-03#section-3.2" class="relref">Section 3.2</a> of [<a href="#I-D.bormann-cbor-det" class="cite xref">I-D.bormann-cbor-det</a>]</span> for
more explanation as well as examples.
As the CDE would continually
need to address additional issues raised by the registration of new
tags, this specification recommends that new tag registrations address
deterministic encoding in the context of this Profile.<a href="#section-2-7" class="pilcrow">¶</a></p>
<p id="section-2-8">A particularly difficult field to obtain deterministic encoding for is
floating point numbers, partially because they themselves are often
obtained from processes that are not entirely deterministic between platforms.
See <span><a href="https://datatracker.ietf.org/doc/html/draft-bormann-cbor-det-03#section-3.2.2" class="relref">Section 3.2.2</a> of [<a href="#I-D.bormann-cbor-det" class="cite xref">I-D.bormann-cbor-det</a>]</span> for more details.
Section <a href="https://rfc-editor.org/rfc/rfc8949#section-4.2.2" class="relref">4.2.2</a> of RFC 8949 <span>[<a href="#STD94" class="cite xref">STD94</a>]</span> presents a number of choices, which need to
be made to obtain a CBOR Common Deterministic Encoding Profile (CDE).
Specifically, CDE specifies (in the order of the bullet list at the end of Section <a href="https://rfc-editor.org/rfc/rfc8949#section-4.2.2" class="relref">4.2.2</a> of RFC 8949 <span>[<a href="#STD94" class="cite xref">STD94</a>]</span>):<a href="#section-2-8" class="pilcrow">¶</a></p>
<ol start="2" type="1" class="normal type-1" id="section-2-9">
<li id="section-2-9.1">
          <p id="section-2-9.1.1">Besides the mandated use of preferred serialization, there is no further
specific action for the two different zero values, e.g., an encoder
that is asked by an application to represent a negative floating
point zero will generate 0xf98000.<a href="#section-2-9.1.1" class="pilcrow">¶</a></p>
</li>
        <li id="section-2-9.2">
          <p id="section-2-9.2.1">There is no attempt to mix integers and floating point numbers,
i.e., all floating point values are encoded as the preferred
floating-point representation that accurately represents the value,
independent of whether the floating point value is, mathematically,
an integral value (choice 2 of the second bullet).<a href="#section-2-9.2.1" class="pilcrow">¶</a></p>
</li>
        <li id="section-2-9.3">
          <p id="section-2-9.3.1">Apart from finite and infinite numbers, <span>[<a href="#IEEE754" class="cite xref">IEEE754</a>]</span> floating point
values include NaN (not a number) values <span>[<a href="#I-D.bormann-cbor-numbers" class="cite xref">I-D.bormann-cbor-numbers</a>]</span>.
In CDE, there is no special handling of NaN values, except that the
preferred serialization rules also apply to NaNs (with zero or
non-zero payloads), using the canonical encoding of NaNs as defined
in Section 6.2.1 of <span>[<a href="#IEEE754" class="cite xref">IEEE754</a>]</span>.
Specifically, this means that shorter forms of encodings for a NaN
are used when that can be achieved by only removing trailing zeros
in the NaN payload.
Further clarifying a "should"-level statement in Section 6.2.1 of
<span>[<a href="#IEEE754" class="cite xref">IEEE754</a>]</span>, the CBOR encoding always uses a leading bit of 1 in the
significand to encode a quiet NaN; the use of signaling NaNs by
application protocols is <span class="bcp14">NOT RECOMMENDED</span> but when presented by an
application these are encoded by using a leading bit of 0.<a href="#section-2-9.3.1" class="pilcrow">¶</a></p>
<p id="section-2-9.3.2">
Typically, most applications that employ NaNs in their storage and
communication interfaces will only use a quiet NaN with payload 0,
which therefore deterministically encodes as 0xf97e00.<a href="#section-2-9.3.2" class="pilcrow">¶</a></p>
</li>
        <li id="section-2-9.4">
          <p id="section-2-9.4.1">There is no special handling of subnormal values.<a href="#section-2-9.4.1" class="pilcrow">¶</a></p>
</li>
        <li id="section-2-9.5">
          <p id="section-2-9.5.1">The CBOR Common Deterministic Encoding Profile does not presume
equivalence of basic floating point values with floating point
values using other representations (e.g., tag 4/5).
Such equivalences and related deterministic representation rules
can be added at the application (profile) level if desired.<a href="#section-2-9.5.1" class="pilcrow">¶</a></p>
</li>
      </ol>
<p id="section-2-10">The main intent here is to preserve the basic generic data model, so
applications (or Application Profiles, see <a href="#application-profiles" class="auto internal xref">Appendix A</a>) can
make their own decisions within that data model.
E.g., an application (profile) can decide that it only ever allows a
single NaN value that would be encoded as 0xf97e00, so a CDE
implementation focusing on this application (profile) would not need to
provide processing for other NaN values.
Basing the definition of both CDE and Application Profiles on the
generic data model of CBOR also means that there is no effect on the
Concise Data Definition Language (CDDL)
<span>[<a href="#RFC8610" class="cite xref">RFC8610</a>]</span>, except where the data description documents encoding decisions
for byte strings that carry embedded CBOR.<a href="#section-2-10" class="pilcrow">¶</a></p>
</section>
</div>
<div id="cddl-support">
<section id="section-3">
      <h2 id="name-cddl-support">
<a href="#section-3" class="section-number selfRef">3. </a><a href="#name-cddl-support" class="section-name selfRef">CDDL support</a>
      </h2>
<p id="section-3-1"><span>[<a href="#RFC8610" class="cite xref">RFC8610</a>]</span> defines control operators to indicate that the contents of a
byte string carries a CBOR-encoded data item (<code>.cbor</code>) or a sequence of
CBOR-encoded data items (<code>.cborseq</code>).<a href="#section-3-1" class="pilcrow">¶</a></p>
<p id="section-3-2">CDDL specifications may want to specify that the data items should be
encoded in Common CBOR Deterministic Encoding.
The present specification adds two CDDL control operators that can be used
for this.<a href="#section-3-2" class="pilcrow">¶</a></p>
<p id="section-3-3">The control operators <code>.cde</code> and <code>.cdeseq</code> are exactly like <code>.cbor</code> and
<code>.cborseq</code> except that they also require the encoded data item(s) to be
encoded according to CDE.<a href="#section-3-3" class="pilcrow">¶</a></p>
<p id="section-3-4">For example, a byte string of embedded CBOR that is to be encoded
according to CDE can be formalized as:<a href="#section-3-4" class="pilcrow">¶</a></p>
<div class="alignLeft art-text artwork" id="section-3-5">
<pre>
leaf = #6.24(bytes .cde any)
</pre><a href="#section-3-5" class="pilcrow">¶</a>
</div>
<p id="section-3-6">More importantly, if the encoded data item also needs to have a
specific structure, this can be expressed by the right-hand side
(instead of using the most general CDDL type <code>any</code> here).<a href="#section-3-6" class="pilcrow">¶</a></p>
<p id="section-3-7">(Note that the <code>.cborseq</code> control operator does not enable specifying
different deterministic encoding requirements for the elements of the
sequence.  If a use case for such a feature becomes known, it could be
added.)<a href="#section-3-7" class="pilcrow">¶</a></p>
<p id="section-3-8">Obviously, Application Profiles can define related control operators
that also embody the processing required by the Application Profile,
and are encouraged to do so.<a href="#section-3-8" class="pilcrow">¶</a></p>
</section>
</div>
<div id="seccons">
<section id="section-4">
      <h2 id="name-security-considerations">
<a href="#section-4" class="section-number selfRef">4. </a><a href="#name-security-considerations" class="section-name selfRef">Security Considerations</a>
      </h2>
<p id="section-4-1">The security considerations in Section <a href="https://rfc-editor.org/rfc/rfc8949#section-10" class="relref">10</a> of RFC 8949 <span>[<a href="#STD94" class="cite xref">STD94</a>]</span> apply.
The use of deterministic encoding can mitigate issues arising out of
the use of non-preferred serializations specially crafted by an attacker.
However, this effect only accrues if the decoder actually checks that
deterministic encoding was applied correctly.
More generally, additional security properties of deterministic
encoding can rely on this check being performed properly.<a href="#section-4-1" class="pilcrow">¶</a></p>
</section>
</div>
<div id="sec-iana">
<section id="section-5">
      <h2 id="name-iana-considerations">
<a href="#section-5" class="section-number selfRef">5. </a><a href="#name-iana-considerations" class="section-name selfRef">IANA Considerations</a>
      </h2>
<p id="section-5-1"><span class="cref" id="to-be-removed">RFC Editor: please replace RFCXXXX with the RFC
number of this RFC and remove this note.</span><a href="#section-5-1" class="pilcrow">¶</a></p>
<p id="section-5-2">This document requests IANA to register the contents of
<a href="#tbl-iana-reqs" class="auto internal xref">Table 1</a> into the registry
"<a href="https://www.iana.org/assignments/cddl#cddl-control-operators" class="relref">CDDL Control Operators</a>" of the
<span>[<a href="#IANA.cddl" class="cite xref">IANA.cddl</a>]</span> registry group:<a href="#section-5-2" class="pilcrow">¶</a></p>
<span id="name-new-control-operators-to-be"></span><div id="tbl-iana-reqs">
<table class="center" id="table-1">
        <caption>
<a href="#table-1" class="selfRef">Table 1</a>:
<a href="#name-new-control-operators-to-be" class="selfRef">New control operators to be registered</a>
        </caption>
<thead>
          <tr>
            <th class="text-left" rowspan="1" colspan="1">Name</th>
            <th class="text-left" rowspan="1" colspan="1">Reference</th>
          </tr>
        </thead>
        <tbody>
          <tr>
            <td class="text-left" rowspan="1" colspan="1">.cde</td>
            <td class="text-left" rowspan="1" colspan="1">[RFCXXXX]</td>
          </tr>
          <tr>
            <td class="text-left" rowspan="1" colspan="1">.cdeseq</td>
            <td class="text-left" rowspan="1" colspan="1">[RFCXXXX]</td>
          </tr>
        </tbody>
      </table>
</div>
</section>
</div>
<div id="sec-combined-references">
<section id="section-6">
      <h2 id="name-references">
<a href="#section-6" class="section-number selfRef">6. </a><a href="#name-references" class="section-name selfRef">References</a>
      </h2>
<div id="sec-normative-references">
<section id="section-6.1">
        <h3 id="name-normative-references">
<a href="#section-6.1" class="section-number selfRef">6.1. </a><a href="#name-normative-references" class="section-name selfRef">Normative References</a>
        </h3>
<dl class="references">
<dt id="BCP14">[BCP14]</dt>
        <dd>
<div class="refInstance">Best Current Practice 14, <span>&lt;<a href="https://www.rfc-editor.org/info/bcp14">https://www.rfc-editor.org/info/bcp14</a>&gt;</span>.<br><span>At the time of writing, this BCP comprises the following:</span>
</div>
<div class="refInstance" id="RFC2119">
            <span class="refAuthor">Bradner, S.</span>, <span class="refTitle">"Key words for use in RFCs to Indicate Requirement Levels"</span>, <span class="seriesInfo">BCP 14</span>, <span class="seriesInfo">RFC 2119</span>, <span class="seriesInfo">DOI 10.17487/RFC2119</span>, <time datetime="1997-03" class="refDate">March 1997</time>, <span>&lt;<a href="https://www.rfc-editor.org/info/rfc2119">https://www.rfc-editor.org/info/rfc2119</a>&gt;</span>. </div>
<div class="refInstance" id="RFC8174">
            <span class="refAuthor">Leiba, B.</span>, <span class="refTitle">"Ambiguity of Uppercase vs Lowercase in RFC 2119 Key Words"</span>, <span class="seriesInfo">BCP 14</span>, <span class="seriesInfo">RFC 8174</span>, <span class="seriesInfo">DOI 10.17487/RFC8174</span>, <time datetime="2017-05" class="refDate">May 2017</time>, <span>&lt;<a href="https://www.rfc-editor.org/info/rfc8174">https://www.rfc-editor.org/info/rfc8174</a>&gt;</span>. </div>
</dd>
<dd class="break"></dd>
<dt id="IANA.cddl">[IANA.cddl]</dt>
        <dd>
<span class="refAuthor">IANA</span>, <span class="refTitle">"Concise Data Definition Language (CDDL)"</span>, <span>&lt;<a href="https://www.iana.org/assignments/cddl">https://www.iana.org/assignments/cddl</a>&gt;</span>. </dd>
<dd class="break"></dd>
<dt id="IEEE754">[IEEE754]</dt>
        <dd>
<span class="refAuthor">IEEE</span>, <span class="refTitle">"IEEE Standard for Floating-Point Arithmetic"</span>, <span class="seriesInfo">IEEE Std 754-2019</span>, <span class="seriesInfo">DOI 10.1109/IEEESTD.2019.8766229</span>, <span>&lt;<a href="https://ieeexplore.ieee.org/document/8766229">https://ieeexplore.ieee.org/document/8766229</a>&gt;</span>. </dd>
<dd class="break"></dd>
<dt id="RFC8610">[RFC8610]</dt>
        <dd>
<span class="refAuthor">Birkholz, H.</span>, <span class="refAuthor">Vigano, C.</span>, and <span class="refAuthor">C. Bormann</span>, <span class="refTitle">"Concise Data Definition Language (CDDL): A Notational Convention to Express Concise Binary Object Representation (CBOR) and JSON Data Structures"</span>, <span class="seriesInfo">RFC 8610</span>, <span class="seriesInfo">DOI 10.17487/RFC8610</span>, <time datetime="2019-06" class="refDate">June 2019</time>, <span>&lt;<a href="https://www.rfc-editor.org/rfc/rfc8610">https://www.rfc-editor.org/rfc/rfc8610</a>&gt;</span>. </dd>
<dd class="break"></dd>
<dt id="STD94">[STD94]</dt>
      <dd>
<div class="refInstance">Internet Standard 94, <span>&lt;<a href="https://www.rfc-editor.org/info/std94">https://www.rfc-editor.org/info/std94</a>&gt;</span>.<br><span>At the time of writing, this STD comprises the following:</span>
</div>
<div class="refInstance" id="RFC8949">
            <span class="refAuthor">Bormann, C.</span> and <span class="refAuthor">P. Hoffman</span>, <span class="refTitle">"Concise Binary Object Representation (CBOR)"</span>, <span class="seriesInfo">STD 94</span>, <span class="seriesInfo">RFC 8949</span>, <span class="seriesInfo">DOI 10.17487/RFC8949</span>, <time datetime="2020-12" class="refDate">December 2020</time>, <span>&lt;<a href="https://www.rfc-editor.org/info/rfc8949">https://www.rfc-editor.org/info/rfc8949</a>&gt;</span>. </div>
</dd>
<dd class="break"></dd>
</dl>
</section>
</div>
<div id="sec-informative-references">
<section id="section-6.2">
        <h3 id="name-informative-references">
<a href="#section-6.2" class="section-number selfRef">6.2. </a><a href="#name-informative-references" class="section-name selfRef">Informative References</a>
        </h3>
<dl class="references">
<dt id="I-D.bormann-cbor-det">[I-D.bormann-cbor-det]</dt>
        <dd>
<span class="refAuthor">Bormann, C.</span>, <span class="refTitle">"CBOR: On Deterministic Encoding"</span>, <span class="refContent">Work in Progress</span>, <span class="seriesInfo">Internet-Draft, draft-bormann-cbor-det-03</span>, <time datetime="2024-07-21" class="refDate">21 July 2024</time>, <span>&lt;<a href="https://datatracker.ietf.org/doc/html/draft-bormann-cbor-det-03">https://datatracker.ietf.org/doc/html/draft-bormann-cbor-det-03</a>&gt;</span>. </dd>
<dd class="break"></dd>
<dt id="I-D.bormann-cbor-numbers">[I-D.bormann-cbor-numbers]</dt>
        <dd>
<span class="refAuthor">Bormann, C.</span>, <span class="refTitle">"On Numbers in CBOR"</span>, <span class="refContent">Work in Progress</span>, <span class="seriesInfo">Internet-Draft, draft-bormann-cbor-numbers-00</span>, <time datetime="2024-07-08" class="refDate">8 July 2024</time>, <span>&lt;<a href="https://datatracker.ietf.org/doc/html/draft-bormann-cbor-numbers-00">https://datatracker.ietf.org/doc/html/draft-bormann-cbor-numbers-00</a>&gt;</span>. </dd>
<dd class="break"></dd>
<dt id="I-D.mcnally-deterministic-cbor">[I-D.mcnally-deterministic-cbor]</dt>
      <dd>
<span class="refAuthor">McNally, W.</span>, <span class="refAuthor">Allen, C.</span>, <span class="refAuthor">Bormann, C.</span>, and <span class="refAuthor">L. Lundblade</span>, <span class="refTitle">"dCBOR: A Deterministic CBOR Application Profile"</span>, <span class="refContent">Work in Progress</span>, <span class="seriesInfo">Internet-Draft, draft-mcnally-deterministic-cbor-11</span>, <time datetime="2024-08-08" class="refDate">8 August 2024</time>, <span>&lt;<a href="https://datatracker.ietf.org/doc/html/draft-mcnally-deterministic-cbor-11">https://datatracker.ietf.org/doc/html/draft-mcnally-deterministic-cbor-11</a>&gt;</span>. </dd>
<dd class="break"></dd>
</dl>
</section>
</div>
</section>
</div>
<div id="application-profiles">
<section id="appendix-A">
      <h2 id="name-application-profiles">
<a href="#appendix-A" class="section-number selfRef">Appendix A. </a><a href="#name-application-profiles" class="section-name selfRef">Application Profiles</a>
      </h2>
<p id="appendix-A-1">This appendix is informative.<a href="#appendix-A-1" class="pilcrow">¶</a></p>
<p id="appendix-A-2">While the CBOR Common Deterministic Encoding Profile (CDE) provides
for commonality between different applications of CBOR, it can be useful
to further constrain the set of data items handled in a group of
applications (<em>exclusions</em>) and to define further mappings
(<em>reductions</em>) that help the applications in such a group get by with
the exclusions.<a href="#appendix-A-2" class="pilcrow">¶</a></p>
<p id="appendix-A-3">For example, the dCBOR Application Profile specifies the use of
CDE together with some application-level rules <span>[<a href="#I-D.mcnally-deterministic-cbor" class="cite xref">I-D.mcnally-deterministic-cbor</a>]</span>.<a href="#appendix-A-3" class="pilcrow">¶</a></p>
<p id="appendix-A-4">In general, the application-level rules specified by an Application Profile are
based on the shared CBOR Common Deterministic Encoding Profile; they do
not "fork" CBOR in the sense of requiring distinct generic
encoder/decoder implementations.<a href="#appendix-A-4" class="pilcrow">¶</a></p>
<p id="appendix-A-5">An Application Profile implementation produces well-formed,
deterministically encoded CBOR according to <span>[<a href="#STD94" class="cite xref">STD94</a>]</span>, and existing
generic CBOR decoders will therefore be able to decode it, including
those that check for Deterministic Encoding ("CDE decoders", see also
<a href="#impcheck" class="auto internal xref">Appendix B</a>).
Similarly, generic CBOR encoders will be able to produce valid CBOR
that can be processed by Application Profile implementations, if
handed Application Profile conforming data model level information
from an application.<a href="#appendix-A-5" class="pilcrow">¶</a></p>
<p id="appendix-A-6">Please note that the separation between standard CBOR processing and
the processing required by the Application Profile is a conceptual
one: Instead of employing generic encoders/decoders, both Application
Profile processing and standard CBOR processing
can be combined into a encoder/decoder specifically designed for the
Application Profile.<a href="#appendix-A-6" class="pilcrow">¶</a></p>
<p id="appendix-A-7">An Application Profile is intended to be used in conjunction with an
application, which typically will use a subset of the CBOR generic
data model, which in turn
influences which subset of the application profile is used.
As a result, an Application Profile itself places no direct
requirement on what minimum subset of CBOR is implemented.
For instance, an application profile might define rules for the
processing of floating point values, but there is no requirement that
implementations of that Application Profile support floating point
numbers (or any other kind of number, such as arbitrary precision
integers or 64-bit negative integers) when they are used with
applications that do not use them.<a href="#appendix-A-7" class="pilcrow">¶</a></p>
</section>
</div>
<div id="impcheck">
<section id="appendix-B">
      <h2 id="name-implementers-checklists">
<a href="#appendix-B" class="section-number selfRef">Appendix B. </a><a href="#name-implementers-checklists" class="section-name selfRef">Implementers' Checklists</a>
      </h2>
<p id="appendix-B-1">This appendix is informative.
It provides brief checklists that implementers can use to check their
implementations.
It uses <a href="#RFC2119" class="auto internal xref">RFC2119</a> language, specifically the keyword <span class="bcp14">MUST</span>, to highlight
the specific items that implementers may want to check.
It does not contain any normative mandates.
This appendix is informative.<a href="#appendix-B-1" class="pilcrow">¶</a></p>
<p id="appendix-B-2">Notes:<a href="#appendix-B-2" class="pilcrow">¶</a></p>
<ul class="normal">
<li class="normal" id="appendix-B-3.1">
          <p id="appendix-B-3.1.1">This is largely a restatement of parts of Section <a href="https://rfc-editor.org/rfc/rfc8949#section-4" class="relref">4</a> of RFC 8949 <span>[<a href="#STD94" class="cite xref">STD94</a>]</span>.
The purpose of the restatement is to aid the work of implementers,
not to redefine anything.<a href="#appendix-B-3.1.1" class="pilcrow">¶</a></p>
<p id="appendix-B-3.1.2">
Preferred Serialization Encoders and Decoders as well as CDE
Encoders and Decoders have certain properties that are expressed
using <a href="#RFC2119" class="auto internal xref">RFC2119</a> keywords in this appendix.<a href="#appendix-B-3.1.2" class="pilcrow">¶</a></p>
</li>
        <li class="normal" id="appendix-B-3.2">
          <p id="appendix-B-3.2.1">Duplicate map keys are never valid in CBOR at all (see
list item "Major type 5" in Section <a href="https://rfc-editor.org/rfc/rfc8949#section-3.1" class="relref">3.1</a> of RFC 8949 <span>[<a href="#STD94" class="cite xref">STD94</a>]</span>)
no matter what sort of serialization is used.
Of the various strategies listed in Section <a href="https://rfc-editor.org/rfc/rfc8949#section-5.6" class="relref">5.6</a> of RFC 8949 <span>[<a href="#STD94" class="cite xref">STD94</a>]</span>,
detecting duplicates and handling them as an error instead of
passing invalid data to the application is the most robust one;
achieving this level of robustness is a mark of quality of
implementation.<a href="#appendix-B-3.2.1" class="pilcrow">¶</a></p>
</li>
        <li class="normal" id="appendix-B-3.3">
          <p id="appendix-B-3.3.1">Preferred serialization and CDE only affect serialization.
They do not place any requirements, exclusions, mappings or such on
the data model level.
Application profiles such as dCBOR are different as they can affect
the data model by restricting some values and ranges.<a href="#appendix-B-3.3.1" class="pilcrow">¶</a></p>
</li>
        <li class="normal" id="appendix-B-3.4">
          <p id="appendix-B-3.4.1">CBOR decoders in general are not required to check for preferred
serialization or CDE and reject inputs that do not fulfill
their requirements.
However, in an environment that employs deterministic encoding,
employing non-checking CBOR decoders negates many of its benefits.
Decoder implementations that advertise "support" for preferred
serialization or CDE need to check the encoding and reject
input that is not encoded to the encoding specification in use.
Again, application profiles such as dCBOR may pose additional
requirements, such as requiring rejection of non-conforming inputs.<a href="#appendix-B-3.4.1" class="pilcrow">¶</a></p>
<p id="appendix-B-3.4.2">
If a generic decoder needs to be used that does not "support" CDE, a
simple (but somewhat clumsy) way to check for proper CDE encoding is
to re-encode the decoded data and check for bit-to-bit equality with
the original input.<a href="#appendix-B-3.4.2" class="pilcrow">¶</a></p>
</li>
      </ul>
<div id="ps">
<section id="appendix-B.1">
        <h3 id="name-preferred-serialization">
<a href="#appendix-B.1" class="section-number selfRef">B.1. </a><a href="#name-preferred-serialization" class="section-name selfRef">Preferred Serialization</a>
        </h3>
<p id="appendix-B.1-1">In the following, the abbreviation "ai" will be used for the 5-bit
additional information field in the first byte of an encoded CBOR data
item, which follows the 3-bit field for the major type.<a href="#appendix-B.1-1" class="pilcrow">¶</a></p>
<div id="pse">
<section id="appendix-B.1.1">
          <h4 id="name-preferred-serialization-enc">
<a href="#appendix-B.1.1" class="section-number selfRef">B.1.1. </a><a href="#name-preferred-serialization-enc" class="section-name selfRef">Preferred Serialization Encoders</a>
          </h4>
<ol start="1" type="1" class="normal type-1" id="appendix-B.1.1-1">
<li id="appendix-B.1.1-1.1">
              <p id="appendix-B.1.1-1.1.1">Shortest-form encoding of the argument <span class="bcp14">MUST</span> be used for all major
types.
Major type 7 is used for floating-point and simple values; floating
point values have its specific rules for how the shortest form is
derived for the argument.
The shortest form encoding for any argument that is not a floating
point value is:<a href="#appendix-B.1.1-1.1.1" class="pilcrow">¶</a></p>
<ul class="normal">
<li class="normal" id="appendix-B.1.1-1.1.2.1">
                  <p id="appendix-B.1.1-1.1.2.1.1">0 to 23 and -1 to -24 <span class="bcp14">MUST</span> be encoded in the same byte as the
major type.<a href="#appendix-B.1.1-1.1.2.1.1" class="pilcrow">¶</a></p>
</li>
                <li class="normal" id="appendix-B.1.1-1.1.2.2">
                  <p id="appendix-B.1.1-1.1.2.2.1">24 to 255 and -25 to -256 <span class="bcp14">MUST</span> be encoded only with an additional
byte (ai = 0x18).<a href="#appendix-B.1.1-1.1.2.2.1" class="pilcrow">¶</a></p>
</li>
                <li class="normal" id="appendix-B.1.1-1.1.2.3">
                  <p id="appendix-B.1.1-1.1.2.3.1">256 to 65535 and -257 to -65536 <span class="bcp14">MUST</span> be encoded only with an
additional two bytes (ai = 0x19).<a href="#appendix-B.1.1-1.1.2.3.1" class="pilcrow">¶</a></p>
</li>
                <li class="normal" id="appendix-B.1.1-1.1.2.4">
                  <p id="appendix-B.1.1-1.1.2.4.1">65536 to 4294967295 and -65537 to -4294967296 <span class="bcp14">MUST</span> be encoded
only with an additional four bytes (ai = 0x1a).<a href="#appendix-B.1.1-1.1.2.4.1" class="pilcrow">¶</a></p>
</li>
              </ul>
</li>
            <li id="appendix-B.1.1-1.2">
              <p id="appendix-B.1.1-1.2.1">If floating-point numbers are emitted, the following apply:<a href="#appendix-B.1.1-1.2.1" class="pilcrow">¶</a></p>
<ul class="normal">
<li class="normal" id="appendix-B.1.1-1.2.2.1">
                  <p id="appendix-B.1.1-1.2.2.1.1">The length of the argument indicates half (binary16, ai = 0x19),
single (binary32, ai = 0x1a) and double (binary64, ai = 0x1b)
precision encoding.
If multiple of these encodings preserve the precision of the
value to be encoded, only the shortest form of these <span class="bcp14">MUST</span> be
emitted.
That is, encoders <span class="bcp14">MUST</span> support half-precision and
single-precision floating point.<a href="#appendix-B.1.1-1.2.2.1.1" class="pilcrow">¶</a></p>
</li>
                <li class="normal" id="appendix-B.1.1-1.2.2.2">
                  <p id="appendix-B.1.1-1.2.2.2.1"><span>[<a href="#IEEE754" class="cite xref">IEEE754</a>]</span> Infinites and NaNs, and thus NaN payloads, <span class="bcp14">MUST</span> be
supported, to the extent possible on the platform.<a href="#appendix-B.1.1-1.2.2.2.1" class="pilcrow">¶</a></p>
<p id="appendix-B.1.1-1.2.2.2.2">
As with all floating point numbers, Infinites and NaNs <span class="bcp14">MUST</span> be
encoded in the shortest of double, single or half precision that
preserves the value:<a href="#appendix-B.1.1-1.2.2.2.2" class="pilcrow">¶</a></p>
<ul class="normal">
<li class="normal" id="appendix-B.1.1-1.2.2.2.3.1">
                      <p id="appendix-B.1.1-1.2.2.2.3.1.1">Positive and negative infinity and zero <span class="bcp14">MUST</span> be represented in
half-precision floating point.<a href="#appendix-B.1.1-1.2.2.2.3.1.1" class="pilcrow">¶</a></p>
</li>
                    <li class="normal" id="appendix-B.1.1-1.2.2.2.3.2">
                      <p id="appendix-B.1.1-1.2.2.2.3.2.1">For NaNs, the value to be preserved includes the sign bit,
the quiet bit, and the NaN payload (whether zero or non-zero).
The shortest form is obtained by removing the rightmost N bits of the
payload, where N is the difference in the number of bits in the
significand (mantissa representation) between the original format
and the shortest format.
This trimming is performed only (preserves the value only) if all the
rightmost bits removed are zero.
(This will always represent a double or single quiet NaN with a zero
NaN payload in a half-precision quiet NaN.)<a href="#appendix-B.1.1-1.2.2.2.3.2.1" class="pilcrow">¶</a></p>
</li>
                  </ul>
</li>
              </ul>
</li>
            <li id="appendix-B.1.1-1.3">
              <p id="appendix-B.1.1-1.3.1">If tags 2 and 3 are supported, the following apply:<a href="#appendix-B.1.1-1.3.1" class="pilcrow">¶</a></p>
<ul class="normal">
<li class="normal" id="appendix-B.1.1-1.3.2.1">
                  <p id="appendix-B.1.1-1.3.2.1.1">Positive integers from 0 to 2^64 - 1 <span class="bcp14">MUST</span> be encoded as a type 0 integer.<a href="#appendix-B.1.1-1.3.2.1.1" class="pilcrow">¶</a></p>
</li>
                <li class="normal" id="appendix-B.1.1-1.3.2.2">
                  <p id="appendix-B.1.1-1.3.2.2.1">Negative integers from -(2^64) to -1 <span class="bcp14">MUST</span> be encoded as a type 1 integer.<a href="#appendix-B.1.1-1.3.2.2.1" class="pilcrow">¶</a></p>
</li>
                <li class="normal" id="appendix-B.1.1-1.3.2.3">
                  <p id="appendix-B.1.1-1.3.2.3.1">Leading zeros <span class="bcp14">MUST NOT</span> be present in the byte string content of tag 2 and 3.<a href="#appendix-B.1.1-1.3.2.3.1" class="pilcrow">¶</a></p>
</li>
              </ul>
<p id="appendix-B.1.1-1.3.3">
(This also applies to the use of tags 2 and 3 within other tags,
such as 4 or 5.)<a href="#appendix-B.1.1-1.3.3" class="pilcrow">¶</a></p>
</li>
          </ol>
</section>
</div>
<div id="psd">
<section id="appendix-B.1.2">
          <h4 id="name-preferred-serialization-dec">
<a href="#appendix-B.1.2" class="section-number selfRef">B.1.2. </a><a href="#name-preferred-serialization-dec" class="section-name selfRef">Preferred Serialization Decoders</a>
          </h4>
<p id="appendix-B.1.2-1">There are no special requirements that CBOR decoders need to meet to
be a Preferred Serialization Decoder.
Partial decoder implementations need to pay attention to at least the
following requirements:<a href="#appendix-B.1.2-1" class="pilcrow">¶</a></p>
<ol start="1" type="1" class="normal type-1" id="appendix-B.1.2-2">
<li id="appendix-B.1.2-2.1">
              <p id="appendix-B.1.2-2.1.1">Decoders <span class="bcp14">MUST</span> accept shortest-form encoded arguments (see Section <a href="https://rfc-editor.org/rfc/rfc8949#section-3" class="relref">3</a> of RFC 8949 <span>[<a href="#STD94" class="cite xref">STD94</a>]</span>).<a href="#appendix-B.1.2-2.1.1" class="pilcrow">¶</a></p>
</li>
            <li id="appendix-B.1.2-2.2">
              <p id="appendix-B.1.2-2.2.1">If arrays or maps are supported, definite-length arrays or maps <span class="bcp14">MUST</span> be accepted.<a href="#appendix-B.1.2-2.2.1" class="pilcrow">¶</a></p>
</li>
            <li id="appendix-B.1.2-2.3">
              <p id="appendix-B.1.2-2.3.1">If text or byte strings are supported, definite-length text or byte
strings <span class="bcp14">MUST</span> be accepted.<a href="#appendix-B.1.2-2.3.1" class="pilcrow">¶</a></p>
</li>
            <li id="appendix-B.1.2-2.4">
              <p id="appendix-B.1.2-2.4.1">If floating-point numbers are supported, the following apply:<a href="#appendix-B.1.2-2.4.1" class="pilcrow">¶</a></p>
<ul class="normal">
<li class="normal" id="appendix-B.1.2-2.4.2.1">
                  <p id="appendix-B.1.2-2.4.2.1.1">Half-precision values <span class="bcp14">MUST</span> be accepted.<a href="#appendix-B.1.2-2.4.2.1.1" class="pilcrow">¶</a></p>
</li>
                <li class="normal" id="appendix-B.1.2-2.4.2.2">
                  <p id="appendix-B.1.2-2.4.2.2.1">Double- and single-precision values <span class="bcp14">SHOULD</span> be accepted; leaving these out
is only foreseen for decoders that need to work in exceptionally
constrained environments.<a href="#appendix-B.1.2-2.4.2.2.1" class="pilcrow">¶</a></p>
</li>
                <li class="normal" id="appendix-B.1.2-2.4.2.3">
                  <p id="appendix-B.1.2-2.4.2.3.1">If double-precision values are accepted, single-precision values
<span class="bcp14">MUST</span> be accepted.<a href="#appendix-B.1.2-2.4.2.3.1" class="pilcrow">¶</a></p>
</li>
                <li class="normal" id="appendix-B.1.2-2.4.2.4">
                  <p id="appendix-B.1.2-2.4.2.4.1">Infinites and NaNs, and thus NaN payloads, <span class="bcp14">MUST</span> be accepted and
presented to the application (not necessarily in the platform
number format, if that doesn't support those values).<a href="#appendix-B.1.2-2.4.2.4.1" class="pilcrow">¶</a></p>
</li>
              </ul>
</li>
            <li id="appendix-B.1.2-2.5">
              <p id="appendix-B.1.2-2.5.1">If big numbers (tags 2 and 3) are supported, type 0 and type 1 integers <span class="bcp14">MUST</span>
be accepted where a tag 2 or 3 would be accepted.  Leading zero bytes
in the tag content of a tag 2 or 3 <span class="bcp14">MUST</span> be ignored.<a href="#appendix-B.1.2-2.5.1" class="pilcrow">¶</a></p>
</li>
          </ol>
</section>
</div>
</section>
</div>
<div id="bs">
<section id="appendix-B.2">
        <h3 id="name-basic-serialization">
<a href="#appendix-B.2" class="section-number selfRef">B.2. </a><a href="#name-basic-serialization" class="section-name selfRef">Basic Serialization</a>
        </h3>
<p id="appendix-B.2-1">Basic Serialization further restricts Preferred Serialization by not
using indefinite length encoding.
A CBOR encoder can choose to employ Basic Serialization in order to
reduce the variability that needs to be handled by decoders,
potentially maximizing interoperability with partial (e.g.,
constrained) CBOR decoder implementations.<a href="#appendix-B.2-1" class="pilcrow">¶</a></p>
<div id="bse">
<section id="appendix-B.2.1">
          <h4 id="name-basic-serialization-encoder">
<a href="#appendix-B.2.1" class="section-number selfRef">B.2.1. </a><a href="#name-basic-serialization-encoder" class="section-name selfRef">Basic Serialization Encoders</a>
          </h4>
<p id="appendix-B.2.1-1">The Basic Serialization Encoder requirements are identical to the
Preferred Serialization Encoder requirements, with the following additions:<a href="#appendix-B.2.1-1" class="pilcrow">¶</a></p>
<ol start="1" type="1" class="normal type-1" id="appendix-B.2.1-2">
<li id="appendix-B.2.1-2.1">
              <p id="appendix-B.2.1-2.1.1">If maps or arrays are emitted, they <span class="bcp14">MUST</span> use definite-length
encoding (never indefinite-length).<a href="#appendix-B.2.1-2.1.1" class="pilcrow">¶</a></p>
</li>
            <li id="appendix-B.2.1-2.2">
              <p id="appendix-B.2.1-2.2.1">If text or byte strings are emitted, they <span class="bcp14">MUST</span> use definite-length
encoding (never indefinite-length).<a href="#appendix-B.2.1-2.2.1" class="pilcrow">¶</a></p>
</li>
          </ol>
</section>
</div>
<div id="bsd">
<section id="appendix-B.2.2">
          <h4 id="name-basic-serialization-decoder">
<a href="#appendix-B.2.2" class="section-number selfRef">B.2.2. </a><a href="#name-basic-serialization-decoder" class="section-name selfRef">Basic Serialization Decoders</a>
          </h4>
<p id="appendix-B.2.2-1">The Basic Serialization Decoder requirements are identical to the
Preferred Serialization Decoder requirements.<a href="#appendix-B.2.2-1" class="pilcrow">¶</a></p>
</section>
</div>
</section>
</div>
<div id="cde">
<section id="appendix-B.3">
        <h3 id="name-cde">
<a href="#appendix-B.3" class="section-number selfRef">B.3. </a><a href="#name-cde" class="section-name selfRef">CDE</a>
        </h3>
<div id="cde-encoders">
<section id="appendix-B.3.1">
          <h4 id="name-cde-encoders">
<a href="#appendix-B.3.1" class="section-number selfRef">B.3.1. </a><a href="#name-cde-encoders" class="section-name selfRef">CDE Encoders</a>
          </h4>
<ol start="1" type="1" class="normal type-1" id="appendix-B.3.1-1">
<li id="appendix-B.3.1-1.1">
              <p id="appendix-B.3.1-1.1.1">CDE encoders <span class="bcp14">MUST</span> only emit CBOR fulfilling the basic
serialization rules (<a href="#bse" class="auto internal xref">Appendix B.2.1</a>).<a href="#appendix-B.3.1-1.1.1" class="pilcrow">¶</a></p>
</li>
            <li id="appendix-B.3.1-1.2">
              <p id="appendix-B.3.1-1.2.1">CDE encoders <span class="bcp14">MUST</span> sort maps by the CBOR representation of the map
key.
The sorting is byte-wise lexicographic order of the encoded map
key data items.<a href="#appendix-B.3.1-1.2.1" class="pilcrow">¶</a></p>
</li>
            <li id="appendix-B.3.1-1.3">
              <p id="appendix-B.3.1-1.3.1">CDE encoders <span class="bcp14">MUST</span> generate CBOR that fulfills basic validity
(Section <a href="https://rfc-editor.org/rfc/rfc8949#section-5.3.1" class="relref">5.3.1</a> of RFC 8949 <span>[<a href="#STD94" class="cite xref">STD94</a>]</span>).  Note that this includes not
emitting duplicate keys in a major type 5 map as well as emitting
only valid UTF-8 in major type 3 text strings.<a href="#appendix-B.3.1-1.3.1" class="pilcrow">¶</a></p>
</li>
          </ol>
</section>
</div>
<div id="cde-decoders">
<section id="appendix-B.3.2">
          <h4 id="name-cde-decoders">
<a href="#appendix-B.3.2" class="section-number selfRef">B.3.2. </a><a href="#name-cde-decoders" class="section-name selfRef">CDE Decoders</a>
          </h4>
<p id="appendix-B.3.2-1">The term "CDE Decoder" is a shorthand for a CBOR decoder that
advertises <em>supporting</em> CDE (see the start of this appendix).<a href="#appendix-B.3.2-1" class="pilcrow">¶</a></p>
<ol start="1" type="1" class="normal type-1" id="appendix-B.3.2-2">
<li id="appendix-B.3.2-2.1">
              <p id="appendix-B.3.2-2.1.1">CDE decoders <span class="bcp14">MUST</span> follow the rules for preferred (and thus basic)
serialization decoders (<a href="#psd" class="auto internal xref">Appendix B.1.2</a>).<a href="#appendix-B.3.2-2.1.1" class="pilcrow">¶</a></p>
</li>
            <li id="appendix-B.3.2-2.2">
              <p id="appendix-B.3.2-2.2.1">CDE decoders <span class="bcp14">MUST</span> check for ordering map keys and for basic
validity of the CBOR encoding (see Section <a href="https://rfc-editor.org/rfc/rfc8949#section-5.3.1" class="relref">5.3.1</a> of RFC 8949 <span>[<a href="#STD94" class="cite xref">STD94</a>]</span>, which includes a check against duplicate map keys
and invalid UTF-8).<a href="#appendix-B.3.2-2.2.1" class="pilcrow">¶</a></p>
<p id="appendix-B.3.2-2.2.2">
To be called a CDE decoder, it <span class="bcp14">MUST NOT</span> present to the application
a decoded data item that fails one of these checks (except maybe via
special diagnostic channels with no potential for confusion with a
correctly CDE-decoded data item).<a href="#appendix-B.3.2-2.2.2" class="pilcrow">¶</a></p>
</li>
          </ol>
</section>
</div>
</section>
</div>
</section>
</div>
<div id="acknowledgments">
<section id="appendix-C">
      <h2 id="name-acknowledgments">
<a href="#name-acknowledgments" class="section-name selfRef">Acknowledgments</a>
      </h2>
<p id="appendix-C-1">An earlier version of this document was based on the work of Wolf
McNally and Christopher Allen as documented in <span>[<a href="#I-D.mcnally-deterministic-cbor" class="cite xref">I-D.mcnally-deterministic-cbor</a>]</span>; more
recent revisions of that document now make use of the present document
and the concept of Application Profile.
We would like to explicitly acknowledge that this work has
contributed greatly to shaping the concept of a CBOR Common
Deterministic Encoding and Application Profiles on top of that.<a href="#appendix-C-1" class="pilcrow">¶</a></p>
</section>
</div>
<div id="contributors">
<section id="appendix-D">
      <h2 id="name-contributors">
<a href="#name-contributors" class="section-name selfRef">Contributors</a>
      </h2>
<address class="vcard">
        <div dir="auto" class="left"><span class="fn nameRole">Laurence Lundblade</span></div>
<div dir="auto" class="left"><span class="org">Security Theory LLC</span></div>
<div class="email">
<span>Email:</span>
<a href="mailto:lgl@securitytheory.com" class="email">lgl@securitytheory.com</a>
</div>
</address>
<p id="appendix-D-1">Laurence provided most of the text that became <a href="#impcheck" class="auto internal xref">Appendix B</a>.<a href="#appendix-D-1" class="pilcrow">¶</a></p>
</section>
</div>
<div id="authors-addresses">
<section id="appendix-E">
      <h2 id="name-authors-address">
<a href="#name-authors-address" class="section-name selfRef">Author's Address</a>
      </h2>
<address class="vcard">
        <div dir="auto" class="left"><span class="fn nameRole">Carsten Bormann</span></div>
<div dir="auto" class="left"><span class="org">Universität Bremen TZI</span></div>
<div dir="auto" class="left"><span class="street-address">Postfach 330440</span></div>
<div dir="auto" class="left">
<span class="postal-code">D-28359</span> <span class="locality">Bremen</span>
</div>
<div dir="auto" class="left"><span class="country-name">Germany</span></div>
<div class="tel">
<span>Phone:</span>
<a href="tel:+49-421-218-63921" class="tel">+49-421-218-63921</a>
</div>
<div class="email">
<span>Email:</span>
<a href="mailto:cabo@tzi.org" class="email">cabo@tzi.org</a>
</div>
</address>
</section>
</div>
<script>const toc = document.getElementById("toc");
toc.querySelector("h2").addEventListener("click", e => {
  toc.classList.toggle("active");
});
toc.querySelector("nav").addEventListener("click", e => {
  toc.classList.remove("active");
});
</script>
</body>
</html>
